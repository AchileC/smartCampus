{% extends 'base.html.twig' %}
{# rooms/detail.html.twig #}
{% block title %}Room Details - {{ room.name }}{% endblock %}

{% block body %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-10 offset-md-1 {% if room.state.value == 'none' %}bg-secondary{%elseif room.state.value == 'waiting' %}bg-primary{% elseif room.state.value == 'stable' %}bg-success{% elseif room.state.value == 'at risk' %}bg-warning{% else %}bg-danger{% endif %} py-5 position-relative">
                <h1 class="text-center text-white mb-0">{{ 'room'| trans}} {{ room.name }}</h1>
            </div>
        </div>

        <!-- Room Information Card -->
        <div class="card w-75 mx-auto mt-4 shadow-lg">
            <div class="card-body">
                <h5 class="card-title">{{ 'room_constants'|trans }}</h5>
                <p class="card-text"><strong>{{ 'ambient_room_state'|trans}} </strong>
                    <span class="badge-custom-size {% if room.state.value == 'none' %}bg-secondary{%elseif room.state.value == 'waiting' %}bg-primary{% elseif room.state.value == 'stable' %}bg-success{% elseif room.state.value == 'at risk' %}bg-warning{% else %}bg-danger{% endif %}">
                        {{ ('_room_state.' ~ room.state.value | upper) | trans | upper }}
                    </span>
                </p>

                {% if room.acquisitionSystem %}

                    <ul class="list-group">
                        <!-- Temperature -->
                        {% set temp = room.acquisitionSystem.temperature %}
                        {% set isHeatingPeriod = "now"|date("m") in ["11", "12", "01", "02", "03", "04"] %}
                        {% set tempCritical = (isHeatingPeriod and (temp < 17 or temp > 23)) or (not isHeatingPeriod and (temp < 22 or temp > 30)) %}
                        {% set tempWarning = not tempCritical and ((isHeatingPeriod and (temp < 19 or temp > 21)) or (not isHeatingPeriod and (temp < 24 or temp > 28))) %}
                        {% set tempClass = tempCritical ? 'list-group-item-danger' : (tempWarning ? 'list-group-item-warning' : 'list-group-item-success') %}
                        <li class="list-group-item {{ tempClass }} p-3">
                            <div class="row">
                                <div class="col-md-6">
                                    {{ tempCritical ? 'üö®' : (tempWarning ? '‚ö†Ô∏è' : '‚úÖ') }}
                                    <strong>{{ 'temperature'|trans }}:</strong>
                                    {{ temp is not null ? temp ~ '¬∞C' : 'no_value_measured'|trans }}
                                    {% if temp is not null %}
                                        <div class="mt-2 small {% if tempCritical %}text-danger{% elseif tempWarning %}text-warning{% else %}text-success{% endif %}">
                                            {% if tempCritical %}
                                                {{ 'critical_error_verify_sensor'|trans }}
                                            {% elseif tempWarning %}
                                                {% if isHeatingPeriod %}
                                                    {% if temp < 17 %}
                                                        {{ 'check_heating_system_adjust_19'|trans }}
                                                    {% elseif temp > 21 %}
                                                        {{ 'heating_period_reduce_heating'|trans }}
                                                    {% endif %}
                                                {% else %}
                                                    {% if temp < 24 %}
                                                        {{ 'adjust_ac_to_26'|trans }}
                                                    {% elseif temp > 28 %}
                                                        {{ 'activate_ac_or_ventilate'|trans }}
                                                    {% endif %}
                                                {% endif %}
                                            {% else %}
                                                {{ 'optimal_temperature_maintained'|trans }}
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    {% set minTemp = 10 %}
                                    {% set maxTemp = 35 %}
                                    {% set currentTempPercentage = max(0, min(100, ((temp - minTemp) / (maxTemp - minTemp) * 100)|round)) %}
                                    <div class="position-relative">
                                        <div class="progress" style="height: 15px;">
                                            {% if isHeatingPeriod %}
                                                <div class="progress-bar bg-danger" role="progressbar" style="width: 28%" aria-valuenow="17" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="10-17¬∞C"></div>
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 8%" aria-valuenow="19" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="17-19¬∞C"></div>
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 8%" aria-valuenow="21" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="19-21¬∞C"></div>
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 8%" aria-valuenow="23" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="21-23¬∞C"></div>
                                                <div class="progress-bar bg-danger" role="progressbar" style="width: 48%" aria-valuenow="35" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="23-35¬∞C"></div>
                                            {% else %}
                                                <div class="progress-bar bg-danger" role="progressbar" style="width: 48%" aria-valuenow="22" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="10-22¬∞C"></div>
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 8%" aria-valuenow="24" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="22-24¬∞C"></div>
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 16%" aria-valuenow="28" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="24-28¬∞C"></div>
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 8%" aria-valuenow="30" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="28-30¬∞C"></div>
                                                <div class="progress-bar bg-danger" role="progressbar" style="width: 20%" aria-valuenow="35" aria-valuemin="10" aria-valuemax="35" data-bs-toggle="tooltip" title="30-35¬∞C"></div>
                                            {% endif %}
                                        </div>
                                        {% if temp %}
                                            <div class="position-absolute" style="left: calc({{ currentTempPercentage }}% - 10px); top: 15px;">
                                                <div style="width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 12px solid {% if tempCritical %}var(--bs-danger){% elseif tempWarning %}var(--bs-warning){% else %}var(--bs-success){% endif %};"></div>
                                                <span class="badge rounded-pill {% if tempCritical %}bg-danger{% elseif tempWarning %}bg-warning{% else %}bg-success{% endif %}" style="transform: translateX(-50%);">{{ temp }}¬∞C</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </li>

                        <!-- Humidity -->
                        {% set hum = room.acquisitionSystem.humidity %}
                        {% set humWarning = (hum > 60 and hum <= 70) or (hum < 30 and hum >= 20) %}
                        {% set humCritical = hum > 70 or hum < 20 %}
                        {% set humClass = humCritical ? 'list-group-item-danger' : (humWarning ? 'list-group-item-warning' : 'list-group-item-success') %}
                        <li class="list-group-item {{ humClass }} p-3">
                            <div class="row">
                                <div class="col-md-6">
                                    {% if humCritical %}
                                        üö®
                                    {% elseif humWarning %}
                                        ‚ö†Ô∏è
                                    {% else %}
                                        ‚úÖ
                                    {% endif %}
                                    <strong>{{ 'humidity'|trans }}:</strong>
                                    {{ hum is not null ? hum ~ '%' : 'no_value_measured'|trans }}
                                    {% if hum is not null %}
                                        <div class="mt-2 small {% if humCritical %}text-danger{% elseif humWarning %}text-warning{% else %}text-success{% endif %}">
                                            {% if humCritical %}
                                                {{ 'urgently_ventilate_consider_dehumidifier'|trans }}
                                            {% elseif humWarning %}
                                                {{ 'monitor_and_ventilate_if_needed'|trans }}
                                            {% else %}
                                                {{ 'optimal_humidity_level'|trans }}
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    {% set currentHumPercentage = hum|default(0) %}
                                    <div class="position-relative">
                                        <div class="progress" style="height: 15px;">
                                            <div class="progress-bar bg-danger" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" data-bs-toggle="tooltip" title="0-20%"></div>
                                            <div class="progress-bar bg-warning" role="progressbar" style="width: 10%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" data-bs-toggle="tooltip" title="20-30%"></div>
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 30%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" data-bs-toggle="tooltip" title="30-60%"></div>
                                            <div class="progress-bar bg-warning" role="progressbar" style="width: 10%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" data-bs-toggle="tooltip" title="60-70%"></div>
                                            <div class="progress-bar bg-danger" role="progressbar" style="width: 30%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" data-bs-toggle="tooltip" title="> 70%"></div>
                                        </div>
                                        {% if hum %}
                                            <div class="position-absolute" style="left: calc({{ currentHumPercentage }}% - 10px); top: 15px;">
                                                <div style="width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 12px solid {% if humCritical %}var(--bs-danger){% elseif humWarning %}var(--bs-warning){% else %}var(--bs-success){% endif %};"></div>
                                                <span class="badge rounded-pill {% if humCritical %}bg-danger{% elseif humWarning %}bg-warning{% else %}bg-success{% endif %}" style="transform: translateX(-50%);">{{ hum }}%</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </li>

                        <!-- CO‚ÇÇ -->
                        {% set co2 = room.acquisitionSystem.co2 %}
                        {% set co2Warning = co2 > 1000 and co2 <= 1500 %}
                        {% set co2Critical = co2 > 1500 %}
                        {% set co2Error = co2 < 440 or co2 > 2000 %}
                        {% set co2Class = co2Error ? 'list-group-item-danger' : (co2Critical ? 'list-group-item-danger' : (co2Warning ? 'list-group-item-warning' : 'list-group-item-success')) %}
                        <li class="list-group-item {{ co2Class }} p-3">
                            <div class="row">
                                <div class="col-md-6">
                                    {% if co2Error %}
                                        üö®
                                    {% elseif co2Critical or co2Warning %}
                                        ‚ö†Ô∏è
                                    {% else %}
                                        ‚úÖ
                                    {% endif %}
                                    <strong>CO‚ÇÇ:</strong>
                                    {{ co2 is not null ? co2 ~ ' ppm' : 'no_value_measured'|trans }}
                                    {% if co2 is not null %}
                                        <div class="mt-2 small {% if co2Error or co2Critical %}text-danger{% elseif co2Warning %}text-warning{% else %}text-success{% endif %}">
                                            {% if co2Error %}
                                                {{ 'check_sensor_status'|trans }}
                                            {% elseif co2 > 1500 and co2 <= 2000 %}
                                                {{ 'ventilate_immediately'|trans }}
                                            {% elseif co2 > 1000 %}
                                                {{ 'consider_ventilation_soon'|trans }}
                                            {% else %}
                                                {{ 'good_air_quality'|trans }}
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    {% set maxCO2 = 2000 %}
                                    {% set currentCO2Percentage = (co2 / maxCO2 * 100)|round %}
                                    <div class="position-relative">
                                        <div class="progress" style="height: 15px;">
                                            <div class="progress-bar bg-danger" role="progressbar" style="width: 22%" aria-valuenow="440" aria-valuemin="0" aria-valuemax="2000" data-bs-toggle="tooltip" title="< 440 ppm"></div>
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 28%" aria-valuenow="1000" aria-valuemin="0" aria-valuemax="2000" data-bs-toggle="tooltip" title="440-1000 ppm"></div>
                                            <div class="progress-bar bg-warning" role="progressbar" style="width: 25%" aria-valuenow="1500" aria-valuemin="0" aria-valuemax="2000" data-bs-toggle="tooltip" title="1000-1500 ppm"></div>
                                            <div class="progress-bar bg-danger" role="progressbar" style="width: 25%" aria-valuenow="2000" aria-valuemin="0" aria-valuemax="2000" data-bs-toggle="tooltip" title="> 1500 ppm"></div>
                                        </div>
                                        {% if co2 %}
                                            <div class="position-absolute" style="left: calc({{ currentCO2Percentage }}% - 10px); top: 15px;">
                                                <div style="width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 12px solid {% if co2Error or co2Critical %}var(--bs-danger){% elseif co2Warning %}var(--bs-warning){% else %}var(--bs-success){% endif %};"></div>
                                                <span class="badge rounded-pill {% if co2Error or co2Critical %}bg-danger{% elseif co2Warning %}bg-warning{% else %}bg-success{% endif %}" style="transform: translateX(-50%);">{{ co2 }} ppm</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                {% else %}
                    <p class="text-muted">No acquisition system</p>
                {% endif %}

            </div>
        </div>

        {% if todayForecast is not null %}
            {# D√©finir le mapping des pictocodes #}
            {% set pictocodeMapping = {
                1: '‚òÄÔ∏è',
                2: 'üå§Ô∏è',
                3: '‚õÖ',
                4: '‚òÅÔ∏è',
                5: 'üå´Ô∏è',
                6: 'üåßÔ∏è',
                7: 'üå¶Ô∏è',
                8: '‚õàÔ∏è',
                9: 'üå®Ô∏è',
                10: 'üå•Ô∏è‚ùÑÔ∏è',
                11: 'üå®Ô∏èüåßÔ∏è',
                12: 'üå¶Ô∏è',
                13: 'üå®Ô∏è',
                14: 'üå¶Ô∏è',
                15: 'üå®Ô∏è',
                16: 'üå¶Ô∏è',
                17: 'üå®Ô∏è'
            } %}

            <div class="card w-75 mx-auto mt-4 shadow-lg">
                <div class="card-body">
                    <h5 class="card-title">Today's Weather Forecast</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-thermometer-snow fs-3 me-3 text-info"></i>
                                <strong>Min Temperature : </strong>&nbsp;{{ todayForecast.temperature_min|round }}¬∞C
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-thermometer-sun fs-3 me-3 text-danger"></i>
                                <strong>Max Temperature : </strong>&nbsp;{{ todayForecast.temperature_max|round }}¬∞C
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-cloud-rain fs-3 me-3 text-secondary"></i>
                                <strong>Precipitation : </strong>&nbsp;{{ todayForecast.precipitation }} mm
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            {# Afficher l'ic√¥ne bas√©e sur le pictocode #}
                            {% set pictocode = todayForecast.pictocode %}
                            {% set weatherIcon = pictocodeMapping[pictocode] ?? '‚ùì' %}
                            <span style="font-size: 5rem;">{{ weatherIcon }}</span>
                        </div>
                    </div>

                    {# G√©n√©rer des conseils d'action bas√©s sur la m√©t√©o #}
                    {% set advice = [] %}

                    {# Conseils bas√©s sur la temp√©rature max #}
                    {# Advice based on max temperature #}
                    {% if todayForecast.temperature_max >= 35 %}
                        {% set advice = advice|merge(['Extreme heat expected! Lower radiator settings and open windows or doors to ventilate the classroom. Monitor the temperature closely to ensure comfort.']) %}
                    {% elseif todayForecast.temperature_max >= 28 %}
                        {% set advice = advice|merge(['Very hot today. Consider lowering the radiator settings and ventilate the classroom by opening windows or doors to maintain a comfortable environment.']) %}
                    {% elseif todayForecast.temperature_max >= 22 %}
                        {% set advice = advice|merge(['Comfortable temperatures. Adjust radiator settings to maintain a pleasant classroom environment. Ventilate as needed to keep the air fresh.']) %}
                    {% elseif todayForecast.temperature_max <= 0 %}
                        {% set advice = advice|merge(['Freezing temperatures. Ensure radiators are set to a higher temperature to keep the classroom warm. Keep windows closed to conserve heat.']) %}
                    {% elseif todayForecast.temperature_max <= 15 %}
                        {% set advice = advice|merge(['Cold today. Increase radiator settings as necessary and ensure windows are closed to maintain warmth.']) %}
                    {% endif %}

                    {# Advice based on min temperature #}
                    {% if todayForecast.temperature_min <= -15 %}
                        {% set advice = advice|merge(['Extremely low temperatures! Set radiators to maximum to ensure the classroom stays warm. Minimize window openings to retain heat.']) %}
                    {% endif %}

                    {# Advice based on precipitation #}
                    {% if todayForecast.precipitation >= 100 %}
                        {% set advice = advice|merge(['Heavy rainfall expected. Ensure windows are tightly closed to prevent humidity ingress. Use doors to ventilate if necessary.']) %}
                    {% elseif todayForecast.precipitation >= 50 %}
                        {% set advice = advice|merge(['Moderate rainfall expected. Keep windows closed and use doors to ventilate the classroom as needed while avoiding excess humidity.']) %}
                    {% elseif todayForecast.precipitation > 0 %}
                        {% set advice = advice|merge(['Light rain expected. Ventilate the classroom by opening windows or doors briefly to refresh the air without allowing excessive humidity.']) %}
                    {% endif %}

                    {# Advice based on pictocode #}
                    {% if todayForecast.pictocode in [6,7,8,9,10,11,12,13,14,15,16,17] %}
                        {% set advice = advice|merge(['Wet conditions anticipated. Ensure proper ventilation to avoid humidity buildup by using doors if opening windows is not ideal.']) %}
                    {% elseif todayForecast.pictocode in [1,2,3,4,5] %}
                        {% set advice = advice|merge(['Clear or partly cloudy weather. Take the opportunity to ventilate the classroom by opening windows (or doors if it\'s too cold outside) during cooler parts of the day.']) %}
                    {% endif %}

                    {# Additional advice for ventilation in a classroom context #}
                    {% if todayForecast.temperature_max >= 20 and todayForecast.temperature_min >= 10 and todayForecast.pictocode in [1,2,3,4,5] %}
                        {% set advice = advice|merge(['Good conditions for ventilation. Open windows or doors during breaks to refresh the air without disrupting the classroom environment.']) %}
                    {% endif %}

                    {# Prioritize advice to avoid contradictions #}
                    {# Extreme conditions advice takes precedence and may exclude less critical advice #}
                    {% if todayForecast.temperature_max >= 35 %}
                        {% set advice = advice|merge(['Priority: Extreme heat conditions.']) %}
                    {% elseif todayForecast.temperature_max <= 0 %}
                        {% set advice = advice|merge(['Priority: Extreme cold conditions.']) %}
                    {% endif %}

                    {# Display the advice #}
                    {% if advice is not empty %}
                        <div class="alert alert-secondary mt-4 p-3">
                            <h6 class="mb-3"><strong>Actionable Advice :</strong></h6>
                            <ul class="list-unstyled mb-0">
                                {% for tip in advice %}
                                    <li class="mb-2" style="display: flex; align-items: flex-start;">
                                        <i class="bi bi-exclamation-circle-fill text-primary me-2"></i>
                                        <span>{{ tip }}</span>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% else %}
                        <div class="mt-3 text-success">
                            No specific advice for today.
                        </div>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="card w-75 mx-auto mt-4 shadow-lg">
                <div class="card-body">
                    <p class="text-muted">Weather forecasts are currently unavailable.</p>
                </div>
            </div>
        {% endif %}


        <!-- Description Card -->
        <div class="card w-75 mx-auto mt-4 shadow-lg">
            <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                <button class="btn btn-link text-white text-decoration-none w-100 d-flex justify-content-between align-items-center"
                        data-bs-toggle="collapse" data-bs-target="#generalInfo" aria-expanded="false">
                    <h5 class="mb-0">{{ 'general_information' | trans }}</h5>
                    <i class="bi bi-chevron-down fs-3"></i>
                </button>
            </div>
            <div id="generalInfo" class="collapse">
                <div class="card-body">
                    <div class="row">
                        <!-- Colonne de gauche pour les informations g√©n√©rales -->
                        <div class="col-md-8">
                            <div class="row g-3">
                                <!-- Nombre de Fen√™tres -->
                                <div class="col-md-6 d-flex align-items-center">
                                    <i class="bi bi-microsoft fs-2 text-secondary me-3"></i>
                                    <div>
                                        <h6 class="mb-0">{{ 'number_of_windows'| trans }}</h6>
                                        <span class="badge bg-secondary rounded-pill">{{ room.nbWindows }}</span>
                                    </div>
                                </div>
                                <!-- Nombre de Chauffages -->
                                <div class="col-md-6 d-flex align-items-center">
                                    <i class="bi bi-thermometer-half fs-2 text-secondary me-3"></i>
                                    <div>
                                        <h6 class="mb-0">{{ 'number_of_heaters'| trans }}</h6>
                                        <span class="badge bg-secondary rounded-pill">{{ room.nbHeaters }}</span>
                                    </div>
                                </div>
                                <!-- Surface -->
                                <div class="col-md-6 d-flex align-items-center">
                                    <i class="bi bi-aspect-ratio fs-2 text-secondary me-3"></i>
                                    <div>
                                        <h6 class="mb-0">Surface</h6>
                                        <span class="badge bg-secondary rounded-pill">{{ room.surface }} m¬≤</span>
                                    </div>
                                </div>
                                <!-- Direction Cardinale -->
                                <div class="col-md-6 d-flex align-items-center">
                                    <i class="bi bi-compass fs-2 text-secondary me-3"></i>
                                    <div>
                                        <h6 class="mb-0">{{ 'cardinal_direction'| trans }}</h6>
                                        <span class="badge bg-secondary rounded-pill">
                                            {{ ('_cardinal_direction.' ~ room.cardinalDirection.value ) |trans}}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Colonne de droite pour les informations de monitoring -->
                        <div class="col-md-4">
                            {% if room.acquisitionSystem %}
                                <div class="alert alert-info mb-0">
                                    <h6 class="alert-heading"><i class="fas fa-info-circle"></i><strong>{{ 'room_monitoring' | trans }}</strong></h6>
                                    <p class="mb-1"><strong>{{ 'heating' | trans }}</strong> Nov-Apr</p>
                                    <p class="mb-1"><strong>{{ 'non_heating' | trans }}</strong> May-Oct</p>
                                    <hr>
                                    <p class="mb-1"><strong>{{ 'optimal_temp' | trans }}</strong></p>
                                    <p class="mb-1"><strong>{{ 'heating' | trans }}</strong> 19 - 21¬∞C </p>
                                    <p class="mb-1"><strong>{{ 'non_heating' | trans }}</strong> 24 - 28¬∞C</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if is_granted('ROLE_MANAGER') %}
            <div class="card w-75 mx-auto mt-4 text-center">
                <div class="card-body">
                    {% if not room.acquisitionSystem %}
                        <h6 class="card-title">{{ 'no_as_assigned_to_room' | trans }}</h6>
                    {% else %}
                        <h6 class="card-title">{{ 'as_assigned_to_room' | trans }}</h6>
                    {% endif %}
                    <a href="{{ path('app_rooms_update', { name: room.name }) }}" class="btn btn-outline-primary me-2">{{ 'update' | trans }}</a>
                </div>
            </div>
        {% endif %}

        <!-- Back to List Button -->
        <div class="card w-75 mx-auto mt-4 text-center">
            <div class="card-body">
                <a href="{{ path('app_rooms') }}" class="btn btn-outline-secondary">{{ 'back_to_room_list' | trans }}</a>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Handle dynamic icon toggle for collapsible elements
            var collapsibleButtons = document.querySelectorAll('[data-bs-toggle="collapse"]');

            collapsibleButtons.forEach(function (button) {
                var targetId = button.getAttribute('data-bs-target');
                var collapsibleElement = document.querySelector(targetId);

                if (collapsibleElement) {
                    collapsibleElement.addEventListener('show.bs.collapse', function () {
                        var icon = button.querySelector('i');
                        if (icon) {
                            icon.classList.remove('bi-chevron-right');
                            icon.classList.add('bi-chevron-down');
                        }
                    });

                    collapsibleElement.addEventListener('hide.bs.collapse', function () {
                        var icon = button.querySelector('i');
                        if (icon) {
                            icon.classList.remove('bi-chevron-down');
                            icon.classList.add('bi-chevron-right');
                        }
                    });
                }
            });
        });
    </script>
{% endblock %}
